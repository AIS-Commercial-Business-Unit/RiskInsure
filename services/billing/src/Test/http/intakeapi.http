### Beneficiary Registration API Tests
### Base URL for local development
@baseUrl = http://localhost:7075/api

### Test 1: Register a valid beneficiary with all required fields
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Ahmed",
  "lastName": "Al-Rashid",
  "dateOfBirth": "1990-05-15",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "SYR123456789",
  "caseStatus": "PENDING"
}

### Test 2: Register beneficiary with all fields populated
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "recordId": "{{$guid}}",
  "correlationId": "{{$guid}}",
  "uploadId": "{{$guid}}",
  "firstName": "Fatima",
  "lastName": "Hassan",
  "dateOfBirth": "1985-08-22",
  "nationality": "Iraqi",
  "documentType": "National ID",
  "documentNumber": "IRQ987654321",
  "email": "fatima.hassan@example.com",
  "phone": "+9647912345678",
  "address": "123 Main Street, Apartment 4B",
  "city": "Baghdad",
  "country": "Iraq",
  "emergencyContact": "Mohammed Hassan",
  "emergencyPhone": "+9647987654321",
  "medicalConditions": "No known allergies",
  "specialNeeds": "Requires wheelchair access",
  "caseStatus": "ACTIVE",
  "caseWorker": "Sarah Smith",
  "notes": "Priority case - family reunification"
}

### Test 3: Register beneficiary with minimum required fields only
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Omar",
  "lastName": "Abdullah",
  "dateOfBirth": "2000-12-01",
  "nationality": "Yemeni",
  "documentType": "Birth Certificate",
  "documentNumber": "YEM2000120100123",
  "caseStatus": "PENDING"
}

### Test 4: Register beneficiary with Driver License
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Layla",
  "lastName": "Mohammed",
  "dateOfBirth": "1992-03-10",
  "nationality": "Lebanese",
  "documentType": "Driver License",
  "documentNumber": "LEB-DL-992310",
  "email": "layla.m@email.com",
  "caseStatus": "PENDING"
}

### Test 5: Register beneficiary with Other document type
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Karim",
  "lastName": "Nassar",
  "dateOfBirth": "1988-07-18",
  "nationality": "Jordanian",
  "documentType": "Other",
  "documentNumber": "JOR-OTH-88718-XYZ",
  "caseStatus": "COMPLETED",
  "notes": "Case completed successfully"
}

### Test 6: Invalid - Missing required field (firstName)
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "lastName": "Test",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "TEST123",
  "caseStatus": "PENDING"
}

### Test 7: Invalid - Date of birth in future
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Future",
  "lastName": "Test",
  "dateOfBirth": "2030-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "FUT123",
  "caseStatus": "PENDING"
}

### Test 8: Invalid - Document number too short (less than 3 chars)
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Short",
  "lastName": "Doc",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "AB",
  "caseStatus": "PENDING"
}

### Test 9: Invalid - Invalid email format
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Invalid",
  "lastName": "Email",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "INV123",
  "email": "not-an-email",
  "caseStatus": "PENDING"
}

### Test 10: Invalid - Invalid case status
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Invalid",
  "lastName": "Status",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "STA123",
  "caseStatus": "INVALID_STATUS"
}

### Test 11: Invalid - First name exceeds max length (53 chars)
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "ThisIsAnExtremelyLongFirstNameThatExceedsTheMaximumAllowedLengthOf53Characters",
  "lastName": "Test",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "LONG123",
  "caseStatus": "PENDING"
}

### Test 12: Invalid - Date format wrong (not YYYY-MM-DD)
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Wrong",
  "lastName": "DateFormat",
  "dateOfBirth": "01/15/1990",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "WDF123",
  "caseStatus": "PENDING"
}

### Test 13: Valid - Edge case with exactly 53 character first name (max length)
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "JohnJacobJingleheimerSchmidtWithAReallyLongLastName",
  "lastName": "Smith",
  "dateOfBirth": "1990-01-01",
  "nationality": "American",
  "documentType": "Passport",
  "documentNumber": "USA-MAX-53",
  "caseStatus": "PENDING"
}

### Test 14: Valid - SUSPENDED case status
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Suspended",
  "lastName": "Case",
  "dateOfBirth": "1995-06-20",
  "nationality": "Sudanese",
  "documentType": "National ID",
  "documentNumber": "SUD-SUSP-123",
  "caseStatus": "SUSPENDED",
  "notes": "Case temporarily suspended pending review"
}

### ============================================================
### DRY RUN (VALIDATION-ONLY) TESTS
### These tests use ?dryRun=true to validate without saving
### ============================================================

### Test 15: Dry Run - Valid data (should pass validation, NOT save to database)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "firstName": "DryRun",
  "lastName": "TestValid",
  "dateOfBirth": "1990-05-15",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "DRYRUN-VALID-001",
  "caseStatus": "PENDING",
  "notes": "This is a dry run test - should validate successfully but NOT create database record"
}

### Test 16: Dry Run - All fields populated (validation only)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "recordId": "{{$guid}}",
  "correlationId": "{{$guid}}",
  "uploadId": "{{$guid}}",
  "firstName": "Complete",
  "lastName": "DryRunTest",
  "dateOfBirth": "1985-08-22",
  "nationality": "Iraqi",
  "documentType": "National ID",
  "documentNumber": "DRYRUN-COMPLETE-002",
  "email": "dryrun.test@example.com",
  "phone": "+9647912345678",
  "address": "456 Test Avenue",
  "city": "Test City",
  "country": "Iraq",
  "emergencyContact": "Emergency Contact",
  "emergencyPhone": "+9647987654321",
  "medicalConditions": "None",
  "specialNeeds": "None",
  "caseStatus": "ACTIVE",
  "caseWorker": "Test Worker",
  "notes": "Dry run with all fields - validates business rules without database commit"
}

### Test 17: Dry Run - Invalid data (missing firstName - should fail validation)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "lastName": "InvalidDryRun",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "DRYRUN-INVALID-003",
  "caseStatus": "PENDING",
  "notes": "Dry run with missing required field - should return validation errors"
}

### Test 18: Dry Run - Invalid date (future date - should fail validation)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "firstName": "Future",
  "lastName": "DateTest",
  "dateOfBirth": "2030-12-31",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "DRYRUN-FUTURE-004",
  "caseStatus": "PENDING",
  "notes": "Dry run with future date - should fail date validation rule"
}

### Test 19: Dry Run - Invalid email format (should fail validation)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "firstName": "InvalidEmail",
  "lastName": "DryRunTest",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "DRYRUN-EMAIL-005",
  "email": "not-a-valid-email-format",
  "caseStatus": "PENDING",
  "notes": "Dry run with invalid email - should fail email validation"
}

### Test 20: Dry Run - First name exceeds max length (should fail validation)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "firstName": "ThisFirstNameIsWayTooLongAndExceedsTheMaximumAllowedLengthOf53CharactersForSure",
  "lastName": "LongName",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "DRYRUN-LONG-006",
  "caseStatus": "PENDING",
  "notes": "Dry run with firstName > 40 chars - should fail length validation"
}

### Test 21: Dry Run - Edge case with exactly 53 character firstName (should pass)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "firstName": "JohnJacobJingleheimerSchmidtWithAReallyLongLastName",
  "lastName": "EdgeCase",
  "dateOfBirth": "1990-01-01",
  "nationality": "American",
  "documentType": "Passport",
  "documentNumber": "DRYRUN-EDGE-007",
  "caseStatus": "PENDING",
  "notes": "Dry run with firstName exactly 40 chars - should pass validation"
}

### Test 22: Compare - Same data WITH dryRun=true (validation only)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "firstName": "Compare",
  "lastName": "Test",
  "dateOfBirth": "1992-06-15",
  "nationality": "Lebanese",
  "documentType": "Passport",
  "documentNumber": "COMPARE-DRYRUN-001",
  "caseStatus": "PENDING",
  "notes": "Compare response: DryRun mode - BeneficiaryId should be null, message should say 'NOT saved'"
}

### Test 23: Compare - Same data WITHOUT dryRun (commit to database)
POST {{baseUrl}}/beneficiary/register
Content-Type: application/json

{
  "firstName": "Compare",
  "lastName": "Test",
  "dateOfBirth": "1992-06-15",
  "nationality": "Lebanese",
  "documentType": "Passport",
  "documentNumber": "COMPARE-COMMIT-001",
  "caseStatus": "PENDING",
  "notes": "Compare response: Normal mode - BeneficiaryId should have GUID value, message should say 'registered successfully'"
}

### Test 24: Dry Run - Invalid case status (should fail validation)
POST {{baseUrl}}/beneficiary/register?dryRun=true
Content-Type: application/json

{
  "firstName": "InvalidStatus",
  "lastName": "DryRunTest",
  "dateOfBirth": "1990-01-01",
  "nationality": "Syrian",
  "documentType": "Passport",
  "documentNumber": "DRYRUN-STATUS-008",
  "caseStatus": "INVALID_STATUS_VALUE",
  "notes": "Dry run with invalid case status - should fail validation"
}
